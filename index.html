<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicia Tu Mejor Versi√≥n - INFIT (Santa Ana)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <!-- Confetti Effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        infit: {
                            black: '#050505',
                            dark: '#121212',
                            gold: '#FFD700',
                            golddim: '#C5A000',
                            white: '#ffffff',
                            gray: '#888888',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Oswald', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #050505 80%);
            color: #f5f5f5;
            overflow-x: hidden;
        }
        .glass-panel {
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.15);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        .combo-card {
            background: linear-gradient(180deg, rgba(255, 215, 0, 0.1) 0%, rgba(5, 5, 5, 0.8) 100%);
            border: 2px solid #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            transform: scale(1.02);
            position: relative;
            z-index: 10;
        }
        .input-field {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            transition: all 0.3s ease;
            color: white;
        }
        .input-field:focus {
            border-color: #FFD700;
            outline: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.1);
        }
        /* Estilo para los d√≠as de la semana */
        .day-checkbox:checked + div {
            background-color: #FFD700;
            color: black;
            border-color: #FFD700;
            font-weight: bold;
        }
        #editor-panel {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        #editor-panel.open {
            transform: translateX(0);
        }
        .admin-only { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans selection:bg-infit-gold selection:text-black">

    <!-- Bot√≥n Admin (Oculto) -->
    <button id="admin-trigger" onclick="toggleEditor()" class="admin-only fixed bottom-4 right-4 z-[90] bg-gray-800 text-gray-400 p-3 rounded-full shadow-lg hover:text-white hover:bg-gray-700 transition-all border border-infit-gold" title="Editar Contenido">
        <i class="fas fa-cog text-xl"></i>
    </button>

    <!-- Panel Admin (Oculto) -->
    <div id="editor-panel" class="admin-only fixed top-0 right-0 h-full w-80 bg-[#1a1a1a] border-l border-gray-700 z-[100] shadow-2xl p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-infit-gold font-heading font-bold uppercase">Editor MXN ($)</h3>
            <button onclick="toggleEditor()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="space-y-4 text-xs">
            <div class="bg-green-900/20 p-2 rounded border border-green-500/30 mb-4">
                <p class="text-green-200">üá≤üáΩ <strong>Versi√≥n Santa Ana Activa</strong></p>
            </div>
            <div>
                <label class="block text-gray-500 mb-1">Texto Promoci√≥n</label>
                <input type="text" id="edit-promo" class="input-field w-full p-2 rounded" oninput="updateContent()">
            </div>
            <div class="border-t border-gray-700 pt-4 mt-4">
                <h4 class="text-white font-bold mb-2">Precios (MXN)</h4>
                <div class="grid grid-cols-2 gap-2">
                    <div><label class="block text-gray-500">Nutrici√≥n</label><input type="number" id="edit-price-nutri" class="input-field w-full p-2 rounded" oninput="updateContent()"></div>
                    <div><label class="block text-gray-500">Entreno</label><input type="number" id="edit-price-train" class="input-field w-full p-2 rounded" oninput="updateContent()"></div>
                    <div><label class="block text-gray-500">Combo Oferta</label><input type="number" id="edit-price-combo" class="input-field w-full p-2 rounded" oninput="updateContent()"></div>
                    <div><label class="block text-gray-500">Combo Original</label><input type="number" id="edit-price-old" class="input-field w-full p-2 rounded" oninput="updateContent()"></div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-4 mt-4">
                <label class="block text-gray-500 mb-1">Nota del Combo</label>
                <textarea id="edit-combo-note" class="input-field w-full p-2 rounded h-20" oninput="updateContent()"></textarea>
            </div>
            <div class="bg-infit-gold/10 p-3 rounded mt-6 border border-infit-gold/20">
                <button onclick="copyConfig()" class="w-full bg-infit-gold text-black font-bold py-2 rounded text-[10px] uppercase hover:bg-white transition-colors">Copiar Configuraci√≥n MX</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <nav class="fixed top-0 w-full z-50 glass-panel border-b border-gray-800/50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fas fa-bolt text-infit-gold text-xl animate-pulse-slow"></i>
                <h1 class="text-2xl font-heading font-bold italic tracking-wider text-white">IN<span class="text-infit-gold">FIT</span></h1>
            </div>
            <div id="affiliate-badge" class="hidden text-[10px] text-gray-500 uppercase border border-gray-800 rounded-full px-3 py-1 bg-black/50">
                Asesor: <span id="affiliate-name" class="text-infit-gold font-bold"></span>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <header class="pt-32 pb-12 px-4 text-center max-w-4xl mx-auto relative">
        <div class="absolute top-20 left-1/2 transform -translate-x-1/2 w-64 h-64 bg-infit-gold opacity-10 blur-[100px] rounded-full pointer-events-none"></div>
        <h2 class="text-4xl md:text-6xl font-heading font-bold uppercase italic mb-4 animate-float">Bienvenido al inicio de<br><span class="text-infit-gold text-glow">Tu Mejor Versi√≥n</span></h2>
        <div class="inline-block bg-infit-gold/10 border border-infit-gold/30 rounded-lg px-6 py-2 mb-8">
            <p class="text-infit-gold text-xs md:text-sm font-bold uppercase tracking-widest"><i class="fas fa-fire mr-2"></i> <span id="display-promo">Promoci√≥n v√°lida solo durante el mes de febrero</span></p>
        </div>
    </header>

    <!-- Pricing MX -->
    <main class="max-w-6xl mx-auto px-4 pb-24 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 items-start">
        
        <!-- Nutrici√≥n -->
        <div class="glass-panel rounded-2xl p-6 relative group hover:bg-white/5 transition-all duration-300 order-2 md:order-1">
            <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-black border border-gray-700 p-3 rounded-full"><i class="fas fa-leaf text-2xl text-green-500"></i></div>
            <h3 class="mt-8 text-xl font-heading font-bold text-center text-white uppercase italic">Nutrici√≥n</h3>
            <div class="text-center my-4">
                <span class="text-3xl font-bold text-infit-gold">$<span id="display-price-nutri">290</span></span>
                <span class="text-sm text-gray-500 uppercase">MXN / Mes</span>
            </div>
            <ul class="space-y-3 text-sm text-gray-400 mb-8">
                <li class="flex items-start gap-2"><i class="fas fa-check text-infit-gold mt-1"></i> Plan 100% personalizado</li>
                <li class="flex items-start gap-2"><i class="fas fa-check text-infit-gold mt-1"></i> Eliminaci√≥n alimentos da√±inos</li>
                <li class="flex items-start gap-2"><i class="fas fa-check text-infit-gold mt-1"></i> Recetas pr√°cticas</li>
            </ul>
            <button onclick="selectPlan('Nutrici√≥n')" class="w-full py-3 rounded-lg border border-gray-600 hover:border-infit-gold hover:text-infit-gold transition-colors text-sm font-bold uppercase tracking-wider">Elegir Nutrici√≥n</button>
        </div>

        <!-- Combo MX -->
        <div class="combo-card rounded-2xl p-8 order-1 md:order-2">
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-600 text-white font-bold px-4 py-1 rounded-full text-xs uppercase tracking-widest shadow-[0_0_15px_#16a34a]">Recomendado Santa Ana üá≤üáΩ</div>
            <div class="text-center mb-6">
                <i class="fas fa-fire text-4xl text-infit-gold mb-4 animate-pulse-slow"></i>
                <h3 class="text-2xl font-heading font-bold text-white uppercase italic">Combo Total</h3>
                <p class="text-[10px] text-infit-gold uppercase tracking-widest mt-1">La experiencia completa</p>
            </div>
            <div class="text-center my-6 border-y border-infit-gold/20 py-4">
                <div class="flex justify-center items-center gap-2">
                    <span class="text-gray-500 line-through text-lg">$<span id="display-price-old">580</span></span>
                    <span class="text-5xl font-bold text-white">$<span id="display-price-combo">490</span></span>
                </div>
                <span class="text-sm text-infit-gold font-bold">MXN / Mes</span>
            </div>
            <ul class="space-y-4 text-sm text-gray-300 mb-8">
                <li class="flex items-start gap-3"><div class="bg-infit-gold/20 p-1 rounded text-infit-gold"><i class="fas fa-dumbbell"></i></div><span class="font-bold text-white">Entrenamiento Digital</span></li>
                <li class="flex items-start gap-3"><div class="bg-infit-gold/20 p-1 rounded text-infit-gold"><i class="fas fa-utensils"></i></div><span class="font-bold text-white">Plan Nutricional Completo</span></li>
                <li class="flex items-start gap-3"><div class="bg-infit-gold/20 p-1 rounded text-infit-gold"><i class="fas fa-calendar-check"></i></div><span>Calendario del Poder + Eliminaci√≥n alimentos da√±inos</span></li>
            </ul>
            <button onclick="selectPlan('Combo Total')" class="w-full bg-infit-gold hover:bg-white text-black font-bold py-4 rounded-lg uppercase tracking-widest transition-all transform hover:scale-105 shadow-[0_0_20px_rgba(255,215,0,0.3)]">QUIERO MI MEJOR VERSI√ìN</button>
            <p class="text-[10px] text-center text-gray-400 mt-4 italic" id="display-combo-note">*La opci√≥n que genera mejores resultados estad√≠sticamente.*</p>
        </div>

        <!-- Entrenamiento -->
        <div class="glass-panel rounded-2xl p-6 relative group hover:bg-white/5 transition-all duration-300 order-3">
            <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-black border border-gray-700 p-3 rounded-full"><i class="fas fa-dumbbell text-2xl text-blue-500"></i></div>
            <h3 class="mt-8 text-xl font-heading font-bold text-center text-white uppercase italic">Entrenamiento</h3>
            <div class="text-center my-4">
                <span class="text-3xl font-bold text-infit-gold">$<span id="display-price-train">290</span></span>
                <span class="text-sm text-gray-500 uppercase">MXN / Mes</span>
            </div>
            <ul class="space-y-3 text-sm text-gray-400 mb-8">
                <li class="flex items-start gap-2"><i class="fas fa-check text-infit-gold mt-1"></i> Rutinas Gym o Casa</li>
                <li class="flex items-start gap-2"><i class="fas fa-check text-infit-gold mt-1"></i> Videos demostrativos</li>
                <li class="flex items-start gap-2"><i class="fas fa-check text-infit-gold mt-1"></i> Calendario de Poder</li>
            </ul>
            <button onclick="selectPlan('Entrenamiento')" class="w-full py-3 rounded-lg border border-gray-600 hover:border-infit-gold hover:text-infit-gold transition-colors text-sm font-bold uppercase tracking-wider">Elegir Entrenamiento</button>
        </div>
    </main>

    <!-- Footer Note (Santa Ana) -->
    <div class="max-w-4xl mx-auto px-6 text-center pb-12">
        <div class="bg-gray-900/50 border border-gray-800 p-4 rounded-xl inline-flex items-center gap-3">
            <i class="fas fa-map-marker-alt text-red-500 animate-bounce"></i>
            <p class="text-xs text-gray-400 text-left">
                <strong class="text-white uppercase">Aviso para Paisanos de Santa Ana:</strong><br>
                Si eres de la comunidad, puedes pagar hasta que tengas todo tu material completo. üìç
            </p>
        </div>
    </div>

    <!-- Modal Formulario -->
    <div id="order-modal" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <div class="fixed inset-0 bg-black/90 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="relative min-h-screen md:min-h-0 flex items-end md:items-center justify-center p-0 md:p-4">
            <div class="w-full md:w-[500px] bg-[#121212] border border-infit-gold/20 rounded-t-3xl md:rounded-2xl p-6 md:p-8 transition-transform duration-300 transform translate-y-full md:translate-y-0" id="modal-panel">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-heading font-bold text-white uppercase italic">Configura tu Plan</h3>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                </div>
                <div class="bg-infit-gold/10 p-3 rounded border border-infit-gold/20 mb-6 flex justify-between items-center">
                    <div>
                        <p class="text-[10px] text-infit-gold uppercase font-bold">Plan Seleccionado</p>
                        <p id="modal-plan-name" class="text-white font-bold text-lg leading-none">Combo Total</p>
                    </div>
                    <div class="text-right">
                        <p class="text-infit-gold font-bold text-xl">$<span id="modal-plan-price">490</span></p>
                        <p class="text-[9px] text-gray-500 uppercase">MXN Mensual</p>
                    </div>
                </div>
                <form id="client-form" onsubmit="handleOrder(event)" class="space-y-4 max-h-[70vh] overflow-y-auto pr-2 custom-scrollbar">
                    <div class="grid grid-cols-1 gap-4">
                        <div><label class="block text-xs text-gray-500 uppercase font-bold mb-1">Nombre Completo</label><input type="text" id="client-name" required class="input-field w-full rounded p-3" placeholder="Ej. Alex Garc√≠a"></div>
                        <div><label class="block text-xs text-gray-500 uppercase font-bold mb-1">Ciudad / Comunidad</label><input type="text" id="client-origin" required class="input-field w-full rounded p-3" placeholder="Ej. Santa Ana Hueytlalpan"></div>
                    </div>

                    <!-- Datos Nutricionales -->
                    <div id="fields-nutrition" class="hidden space-y-4 border-t border-gray-800 pt-4">
                        <div class="flex justify-between items-center"><p class="text-infit-gold text-xs font-bold uppercase"><i class="fas fa-apple-alt mr-1"></i> Datos Nutricionales</p></div>
                        <div class="grid grid-cols-3 gap-2">
                            <div><label class="block text-[10px] text-gray-500 uppercase font-bold mb-1">Edad</label><input type="number" id="client-age" class="input-field w-full rounded p-2 text-sm" placeholder="30"></div>
                            <div><label class="block text-[10px] text-gray-500 uppercase font-bold mb-1">Peso (kg)</label><input type="text" id="client-weight" class="input-field w-full rounded p-2 text-sm" placeholder="70"></div>
                            <div><label class="block text-[10px] text-gray-500 uppercase font-bold mb-1">Estatura (cm)</label><input type="text" id="client-height" class="input-field w-full rounded p-2 text-sm" placeholder="170"></div>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Nivel de Actividad</label>
                            <select id="client-activity" class="input-field w-full rounded p-3 text-sm">
                                <option value="" disabled selected>-- Selecciona --</option>
                                <option value="Sedentario">Sedentario (Poco movimiento)</option>
                                <option value="Ligero">Ligero (1-3 d√≠as suaves)</option>
                                <option value="Moderado">Moderado (3-5 d√≠as activos)</option>
                                <option value="Intenso">Intenso (Deportista)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Datos Entrenamiento (ACTUALIZADO CON D√çAS) -->
                    <div id="fields-training" class="hidden space-y-4 border-t border-gray-800 pt-4">
                        <p class="text-infit-gold text-xs font-bold uppercase"><i class="fas fa-dumbbell mr-1"></i> Datos Entrenamiento</p>
                        
                        <div>
                            <label class="block text-[10px] text-gray-500 uppercase font-bold mb-2">¬øD√≥nde entrenar√°s?</label>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="cursor-pointer"><input type="radio" name="place" value="Gimnasio" class="peer hidden" checked><div class="input-field p-3 rounded text-center text-xs font-bold peer-checked:border-infit-gold peer-checked:text-infit-gold hover:bg-white/5">Gimnasio</div></label>
                                <label class="cursor-pointer"><input type="radio" name="place" value="Casa" class="peer hidden"><div class="input-field p-3 rounded text-center text-xs font-bold peer-checked:border-infit-gold peer-checked:text-infit-gold hover:bg-white/5">Casa</div></label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] text-gray-500 uppercase font-bold mb-2">D√≠as Disponibles a la semana</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex-1 min-w-[45px] cursor-pointer">
                                    <input type="checkbox" name="days" value="Lu" class="peer hidden day-checkbox">
                                    <div class="border border-gray-700 p-2 rounded text-center text-[10px] transition-all peer-checked:bg-infit-gold peer-checked:text-black">Lu</div>
                                </label>
                                <label class="flex-1 min-w-[45px] cursor-pointer">
                                    <input type="checkbox" name="days" value="Ma" class="peer hidden day-checkbox">
                                    <div class="border border-gray-700 p-2 rounded text-center text-[10px] transition-all peer-checked:bg-infit-gold peer-checked:text-black">Ma</div>
                                </label>
                                <label class="flex-1 min-w-[45px] cursor-pointer">
                                    <input type="checkbox" name="days" value="Mi" class="peer hidden day-checkbox">
                                    <div class="border border-gray-700 p-2 rounded text-center text-[10px] transition-all peer-checked:bg-infit-gold peer-checked:text-black">Mi</div>
                                </label>
                                <label class="flex-1 min-w-[45px] cursor-pointer">
                                    <input type="checkbox" name="days" value="Ju" class="peer hidden day-checkbox">
                                    <div class="border border-gray-700 p-2 rounded text-center text-[10px] transition-all peer-checked:bg-infit-gold peer-checked:text-black">Ju</div>
                                </label>
                                <label class="flex-1 min-w-[45px] cursor-pointer">
                                    <input type="checkbox" name="days" value="Vi" class="peer hidden day-checkbox">
                                    <div class="border border-gray-700 p-2 rounded text-center text-[10px] transition-all peer-checked:bg-infit-gold peer-checked:text-black">Vi</div>
                                </label>
                                <label class="flex-1 min-w-[45px] cursor-pointer">
                                    <input type="checkbox" name="days" value="Sa" class="peer hidden day-checkbox">
                                    <div class="border border-gray-700 p-2 rounded text-center text-[10px] transition-all peer-checked:bg-infit-gold peer-checked:text-black">Sa</div>
                                </label>
                                <label class="flex-1 min-w-[45px] cursor-pointer">
                                    <input type="checkbox" name="days" value="Do" class="peer hidden day-checkbox">
                                    <div class="border border-gray-700 p-2 rounded text-center text-[10px] transition-all peer-checked:bg-infit-gold peer-checked:text-black">Do</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 sticky bottom-0 bg-[#121212] border-t border-gray-800">
                        <button type="submit" id="submit-btn" class="w-full bg-[#25D366] text-white font-bold py-4 rounded-lg uppercase tracking-widest hover:bg-[#20bd5a] transition-colors flex justify-center items-center gap-2 shadow-[0_0_15px_rgba(37,211,102,0.3)]">
                            <i class="fab fa-whatsapp text-2xl"></i><span>Finalizar Pedido</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="success-overlay" class="fixed inset-0 z-[110] hidden bg-black flex flex-col items-center justify-center p-4 text-center">
        <div class="bg-infit-gold/10 p-6 rounded-full mb-6 animate-bounce"><i class="fas fa-check text-4xl text-infit-gold"></i></div>
        <h2 class="text-3xl font-heading font-bold text-white uppercase italic mb-2">¬°Todo Listo!</h2>
        <p class="text-gray-400 max-w-md mb-8">Gracias <span id="success-name" class="text-infit-gold font-bold"></span>.<br>Hemos abierto WhatsApp.</p>
        <button onclick="location.reload()" class="text-gray-500 hover:text-white underline text-xs">Volver al inicio</button>
    </div>

    <script>
        // CONFIGURACI√ìN M√âXICO (SANTA ANA)
        let config = {
            promoText: "Promoci√≥n v√°lida solo durante el mes de febrero",
            priceNutri: 290,
            priceTrain: 290,
            priceCombo: 490,
            priceOld: 580,
            comboNote: "*La opci√≥n que genera mejores resultados estad√≠sticamente.*"
        };
        
        let db; let auth; 
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {}; 
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'infit-web';

        try {
            if (typeof firebase !== 'undefined' && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                if (typeof __initial_auth_token !== 'undefined') auth.signInWithCustomToken(__initial_auth_token);
                else auth.signInAnonymously().catch(console.error);
            }
        } catch (e) { console.warn("Offline", e); }

        let selectedPlan = { name: '', price: 0 };
        let affiliateCode = null;

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            if (ref) {
                affiliateCode = ref;
                document.getElementById('affiliate-badge').classList.remove('hidden');
                document.getElementById('affiliate-badge').classList.add('inline-block');
                document.getElementById('affiliate-name').textContent = ref;
            }
            if (urlParams.get('admin') === 'true') {
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
            }
            loadConfig();
        });

        function loadConfig() {
            document.getElementById('display-promo').textContent = config.promoText;
            document.getElementById('display-price-nutri').textContent = config.priceNutri;
            document.getElementById('display-price-train').textContent = config.priceTrain;
            document.getElementById('display-price-combo').textContent = config.priceCombo;
            document.getElementById('display-price-old').textContent = config.priceOld;
            document.getElementById('display-combo-note').textContent = config.comboNote;

            // Editor
            document.getElementById('edit-promo').value = config.promoText;
            document.getElementById('edit-price-nutri').value = config.priceNutri;
            document.getElementById('edit-price-train').value = config.priceTrain;
            document.getElementById('edit-price-combo').value = config.priceCombo;
            document.getElementById('edit-price-old').value = config.priceOld;
            document.getElementById('edit-combo-note').value = config.comboNote;
        }

        function updateContent() {
            config.promoText = document.getElementById('edit-promo').value;
            config.priceNutri = document.getElementById('edit-price-nutri').value;
            config.priceTrain = document.getElementById('edit-price-train').value;
            config.priceCombo = document.getElementById('edit-price-combo').value;
            config.priceOld = document.getElementById('edit-price-old').value;
            config.comboNote = document.getElementById('edit-combo-note').value;
            loadConfig();
        }

        function toggleEditor() { document.getElementById('editor-panel').classList.toggle('open'); }

        function copyConfig() {
            const code = `let config = { promoText: "${config.promoText}", priceNutri: ${config.priceNutri}, priceTrain: ${config.priceTrain}, priceCombo: ${config.priceCombo}, priceOld: ${config.priceOld}, comboNote: "${config.comboNote}" };`;
            navigator.clipboard.writeText(code).then(() => alert("C√≥digo MX copiado!"));
        }

        function selectPlan(planName) {
            let price = 0;
            const fieldsNutri = document.getElementById('fields-nutrition');
            const fieldsTrain = document.getElementById('fields-training');
            fieldsNutri.classList.add('hidden'); fieldsTrain.classList.add('hidden');
            
            if (planName === 'Nutrici√≥n') { price = config.priceNutri; fieldsNutri.classList.remove('hidden'); }
            else if (planName === 'Entrenamiento') { price = config.priceTrain; fieldsTrain.classList.remove('hidden'); }
            else if (planName === 'Combo Total') { price = config.priceCombo; fieldsNutri.classList.remove('hidden'); fieldsTrain.classList.remove('hidden'); }

            selectedPlan = { name: planName, price: price };
            document.getElementById('modal-plan-name').textContent = planName;
            document.getElementById('modal-plan-price').textContent = price;
            
            const modal = document.getElementById('order-modal');
            const panel = document.getElementById('modal-panel');
            modal.classList.remove('hidden');
            setTimeout(() => panel.classList.remove('translate-y-full'), 10);
        }

        function closeModal() {
            const modal = document.getElementById('order-modal');
            const panel = document.getElementById('modal-panel');
            panel.classList.add('translate-y-full');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        async function handleOrder(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';

            const formData = {
                name: document.getElementById('client-name').value,
                origin: document.getElementById('client-origin').value,
                plan: selectedPlan.name,
                price: selectedPlan.price,
                currency: 'MXN',
                affiliate: affiliateCode || 'Org√°nico',
                timestamp: new Date().toISOString()
            };

            let detailsText = "";
            // Captura datos nutricionales
            if (!document.getElementById('fields-nutrition').classList.contains('hidden')) {
                const age = document.getElementById('client-age').value;
                const weight = document.getElementById('client-weight').value;
                const height = document.getElementById('client-height').value;
                const activity = document.getElementById('client-activity').value;
                detailsText += `%0A%0Aüçé *DATOS NUTRICI√ìN*%0A‚Ä¢ Edad: ${age}%0A‚Ä¢ Peso: ${weight} kg%0A‚Ä¢ Altura: ${height} cm%0A‚Ä¢ Actividad: ${activity || '-'}`;
            }
            
            // Captura datos entrenamiento
            if (!document.getElementById('fields-training').classList.contains('hidden')) {
                const place = document.querySelector('input[name="place"]:checked').value;
                const selectedDays = Array.from(document.querySelectorAll('input[name="days"]:checked')).map(el => el.value);
                const daysText = selectedDays.length > 0 ? selectedDays.join(', ') : 'No especificados';
                
                detailsText += `%0A%0AüèãÔ∏è *DATOS ENTRENO*%0A‚Ä¢ Lugar: ${place}%0A‚Ä¢ D√≠as: ${daysText}`;
            }

            if (db) {
                try {
                    const user = auth.currentUser;
                    const path = user ? db.collection('artifacts').doc(appId).collection('public').doc('data').collection('leads') : null;
                    if (path) await path.add(formData);
                } catch (err) { console.error(err); }
            }

            const phone = "527751056744";
            const header = `Hola INFIT! üöÄ Soy *${formData.name}* (Desde ${formData.origin}).%0A%0Aüî• Quiero empezar mi *${formData.plan}* ($${formData.price} MXN / Mes).`;
            const footer = `%0A%0Aüìç *Nota Local:* Soy de Santa Ana. Estoy de acuerdo en pagar hasta tener todo mi material completo.`;
            const deliveryNote = `%0A%0Aüïí *Entrega:* El tiempo aproximado es de 3 d√≠as h√°biles.`;
            const motivation = `%0A%0A‚ú® *¬°Bienvenido a tu mejor Versi√≥n!*`;
            const refText = affiliateCode ? `%0A%0A(Asesor: ${affiliateCode})` : '';

            const fullText = `${header}${detailsText}${footer}${deliveryNote}${motivation}${refText}`;
            window.open(`https://wa.me/${phone}?text=${fullText}`, '_blank');
            
            closeModal();
            showSuccess(formData.name);
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fab fa-whatsapp text-2xl"></i><span>Finalizar Pedido</span>';
        }

        function showSuccess(name) {
            const overlay = document.getElementById('success-overlay');
            document.getElementById('success-name').textContent = name;
            overlay.classList.remove('hidden');
            const end = Date.now() + 2.5 * 1000;
            const colors = ['#FFD700', '#ffffff', '#00ff00'];
            (function frame() {
                confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
                confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }
    </script>
</body>
</html>
